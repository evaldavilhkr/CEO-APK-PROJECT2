<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APK BY CEO APON (Firebase Integrated)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f0f0f0;
        }
        form {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        label {
            display: inline-block;
            width: 120px;
            margin-bottom: 5px;
        }
        input[type="text"], input[type="number"] {
            padding: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
    <h1>ЁЯУж APK BY CEO APON - ржкржгрзНржп ржбрзЗржЯрж╛ ржПржирзНржЯрзНрж░рж┐</h1>

    <form id="product-form">
        <h2>ржирждрзБржи ржкржгрзНржп ржпрзЛржЧ ржХрж░рзБржи</h2>
        <label for="product-name">ржкржгрзНржпрзЗрж░ ржирж╛ржо:</label>
        <input type="text" id="product-name" name="product-name" required><br>
        
        <label for="supplier-name">рж╕рж╛ржкрзНрж▓рж╛ржЗржпрж╝рж╛рж░ ржирж╛ржо:</label>
        <input type="text" id="supplier-name" name="supplier-name" required><br>
        
        <label for="product-quantity">ржкрж░рж┐ржорж╛ржг:</label>
        <input type="number" id="product-quantity" name="product-quantity" min="1" required><br>
        
        <label for="product-price">ржПржХржХ ржорзВрж▓рзНржп:</label>
        <input type="number" id="product-price" name="product-price" min="0" step="0.01" required><br>
        
        <label for="payment">ржкрзНрж░рж╛ржержорж┐ржХ ржкрзЗржорзЗржирзНржЯ:</label>
        <input type="number" id="payment" name="payment" min="0" step="0.01" required><br>
        
        <button type="submit" id="add-product-btn">ржкржгрзНржп ржпрзЛржЧ ржХрж░рзБржи ржПржмржВ рж╕рзЗржн ржХрж░рзБржи</button>
    </form>
    
    <hr>

    <h2>ржкржгрзНржп рждрж╛рж▓рж┐ржХрж╛ (Firebase ржерзЗржХрзЗ рж▓рзЛржб ржХрж░рж╛)</h2>
    <table id="product-table">
        <thead>
            <tr>
                <th>ржкржгрзНржпрзЗрж░ ржирж╛ржо</th>
                <th>рж╕рж╛ржкрзНрж▓рж╛ржЗржпрж╝рж╛рж░ ржирж╛ржо</th>
                <th>ржкрж░рж┐ржорж╛ржг</th>
                <th>ржПржХржХ ржорзВрж▓рзНржп</th>
                <th>ржорзЛржЯ ржЦрж░ржЪ</th>
                <th>ржкрзЗржорзЗржирзНржЯ</th>
                <th>ржмрж╛ржХрж┐</th>
                <th>ржХрзНрж░ржпрж╝ рждрж╛рж░рж┐ржЦ ржУ рж╕ржоржпрж╝</th>
                <th>ржкрзЗржорзЗржирзНржЯ ржХрж░рзБржи</th>
                <th>ржХрзНрж░ржпрж╝/рж╕рзНржЯржХ ржмрж╛ржбрж╝рж╛ржи</th>
                <th>ржбрж┐рж▓рж┐ржЯ</th>
            </tr>
        </thead>
        <tbody id="product-table-body">
            <tr><td colspan="11" style="text-align: center;">ржбрж╛ржЯрж╛ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</td></tr>
        </tbody>
    </table>

    <script>
        // рзз. ржЖржкржирж╛рж░ ржжрзЗржУрзЯрж╛ Firebase ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи
        const firebaseConfig = {
            apiKey: "AIzaSyAWq4Lkt0GCtjcZGvZijI2OO7-6Hu5molM",
            authDomain: "note-by-ceo-5b42a.firebaseapp.com",
            databaseURL: "https://note-by-ceo-5b42a-default-rtdb.firebaseio.com",
            projectId: "note-by-ceo-5b42a",
            storageBucket: "note-by-ceo-5b42a.firebasestorage.app",
            messagingSenderId: "442049744344",
            appId: "1:442049744344:web:8be3da17ede606bb6df6ad",
            measurementId: "G-2V9Y6CEYZE"
        };

        // Firebase ржЗржирж┐рж╢рж┐ржпрж╝рж╛рж▓рж╛ржЗржЬ ржХрж░рж╛
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const productsRef = database.ref('products'); // 'products' ржирж╛ржорзЗ ржПржХржЯрж┐ рж░рзБржЯ рждрзИрж░рж┐ ржХрж░рж╛ рж╣рж▓рзЛ

        // рзи. ржкржгрзНржп ржпрзЛржЧ ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи (Local Storage ржПрж░ ржмржжрж▓рзЗ Firebase ржП рж╕рзЗржн)
        document.getElementById('product-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // ржЗржиржкрзБржЯ ржнрзНржпрж╛рж▓рзБржЧрзБрж▓рзЛ ржирзЗржУржпрж╝рж╛
            const productName = document.getElementById('product-name').value;
            const supplierName = document.getElementById('supplier-name').value;
            const productQuantity = parseInt(document.getElementById('product-quantity').value);
            const productPrice = parseFloat(document.getElementById('product-price').value);
            const payment = parseFloat(document.getElementById('payment').value);

            const totalCost = productQuantity * productPrice;
            const due = totalCost - payment;
            const purchaseDate = new Date().toLocaleString('bn-BD');

            const productData = {
                productName,
                supplierName,
                productQuantity,
                productPrice,
                totalCost: parseFloat(totalCost.toFixed(2)),
                payment: parseFloat(payment.toFixed(2)),
                due: parseFloat(due.toFixed(2)),
                purchaseDate
            };
            
            // Firebase Realtime Database ржП ржбрзЗржЯрж╛ push ржХрж░рж╛
            productsRef.push(productData)
                .then(() => {
                    alert("ржкржгрзНржп рж╕ржлрж▓ржнрж╛ржмрзЗ Firebase-ржП ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ!");
                    document.getElementById('product-form').reset();
                })
                .catch((error) => {
                    console.error("Firebase ржП ржпрзЛржЧ ржХрж░рж╛рж░ рж╕ржоржпрж╝ рждрзНрж░рзБржЯрж┐:", error);
                    alert("ржбрзЗржЯрж╛ рж╕рзЗржн ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред ржХржирж╕рзЛрж▓ ржжрзЗржЦрзБржиред");
                });
        });

        // рзй. Firebase ржерзЗржХрзЗ ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рж╛ ржПржмржВ ржЯрзЗржмрж┐рж▓рзЗ ржкрзНрж░ржжрж░рзНрж╢ржи ржХрж░рж╛
        productsRef.on('value', (snapshot) => {
            const products = [];
            const tableBody = document.getElementById('product-table-body');
            tableBody.innerHTML = ''; // ржЯрзЗржмрж┐рж▓ ржЦрж╛рж▓рж┐ ржХрж░рж╛
            
            if (snapshot.exists()) {
                // Firebase ржерзЗржХрзЗ ржкрж╛ржУржпрж╝рж╛ ржкрзНрж░рждрж┐ржЯрж┐ ржбрзЗржЯрж╛рж░ ржЬржирзНржп
                snapshot.forEach((childSnapshot) => {
                    const product = childSnapshot.val();
                    product.key = childSnapshot.key; // Firebase Key рж╕ржВрж░ржХрзНрж╖ржг
                    products.push(product);
                });

                products.forEach((product) => {
                    // ржбрж╛ржЗржирж╛ржорж┐ржХржнрж╛ржмрзЗ ржЯрзЗржмрж┐рж▓ рж░рзЛ рждрзИрж░рж┐
                    const row = `<tr>
                        <td>${product.productName}</td>
                        <td>${product.supplierName}</td>
                        <td>${product.productQuantity}</td>
                        <td>${product.productPrice}</td>
                        <td>${product.totalCost.toFixed(2)}</td>
                        <td>${product.payment.toFixed(2)}</td>
                        <td>${product.due.toFixed(2)}</td>
                        <td>${product.purchaseDate}</td>
                        <td>
                            <input type="number" id="payment-${product.key}" placeholder="ржкрж░рж┐ржорж╛ржг" min="0" step="0.01">
                            <button onclick="makePayment('${product.key}')">ржкрзЗржорзЗржирзНржЯ</button>
                            <small>рж╢рзЗрж╖ ржкрзЗржорзЗржирзНржЯ: ${product.paymentDate || ''}</small>
                        </td>
                        <td>
                            <input type="number" id="quantity-${product.key}" placeholder="ржкрж░рж┐ржорж╛ржг" min="1">
                            <button onclick="increaseQuantity('${product.key}')">ржХрзНрж░ржпрж╝/рж╕рзНржЯржХ ржмрж╛ржбрж╝рж╛ржи</button>
                        </td>
                        <td><button onclick="deleteProduct('${product.key}')">ржбрж┐рж▓рж┐ржЯ</button></td>
                    </tr>`;
                    tableBody.innerHTML += row;
                });
            } else {
                tableBody.innerHTML = '<tr><td colspan="11" style="text-align: center;">ржХрзЛржирзЛ ржкржгрзНржп ржбрзЗржЯрж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред</td></tr>';
            }
        }, (error) => {
            console.error("ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рж╛рж░ рж╕ржоржпрж╝ рждрзНрж░рзБржЯрж┐:", error);
            document.getElementById('product-table-body').innerHTML = `<tr><td colspan="11" style="color: red; text-align: center;">ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рж╛рж░ рж╕ржоржпрж╝ рждрзНрж░рзБржЯрж┐: ${error.message}</td></tr>`;
        });


        // рзк. ржкрзЗржорзЗржирзНржЯ ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
        window.makePayment = function(key) {
            const paymentInput = document.getElementById(`payment-${key}`);
            const paymentAmount = parseFloat(paymentInput.value);

            if (isNaN(paymentAmount) || paymentAmount <= 0) {
                alert("рж╕ржарж┐ржХ ржкрзЗржорзЗржирзНржЯрзЗрж░ ржкрж░рж┐ржорж╛ржг ржжрж┐ржиред");
                return;
            }

            // Firebase Transaction ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЕрзНржпрж╛ржЯржорж┐ржХ ржЖржкржбрзЗржЯ ржХрж░рж╛
            const productRef = database.ref('products/' + key);
            productRef.transaction((currentProduct) => {
                if (currentProduct) {
                    currentProduct.payment = parseFloat((currentProduct.payment + paymentAmount).toFixed(2));
                    currentProduct.due = parseFloat((currentProduct.due - paymentAmount).toFixed(2));
                    currentProduct.paymentDate = new Date().toLocaleString('bn-BD');
                }
                return currentProduct;
            })
            .then(() => {
                alert(`ржкрзЗржорзЗржирзНржЯ рж╕ржлрж▓: ${paymentAmount} ржЯрж╛ржХрж╛ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред`);
                paymentInput.value = ''; // ржЗржиржкрзБржЯ ржлрж┐рж▓рзНржб ржЦрж╛рж▓рж┐ ржХрж░рж╛
            })
            .catch((error) => {
                console.error("ржкрзЗржорзЗржирзНржЯ ржЖржкржбрзЗржЯрзЗ рждрзНрж░рзБржЯрж┐:", error);
                alert("ржкрзЗржорзЗржирзНржЯ ржЖржкржбрзЗржЯ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред");
            });
        }

        // рзл. рж╕рзНржЯржХ/ржкрж░рж┐ржорж╛ржг ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
        window.increaseQuantity = function(key) {
            const quantityInput = document.getElementById(`quantity-${key}`);
            const quantityToAdd = parseInt(quantityInput.value);

            if (isNaN(quantityToAdd) || quantityToAdd <= 0) {
                alert("рж╕ржарж┐ржХ ржкрж░рж┐ржорж╛ржг ржжрж┐ржиред");
                return;
            }
            
            // Firebase Transaction ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЕрзНржпрж╛ржЯржорж┐ржХ ржЖржкржбрзЗржЯ ржХрж░рж╛
            const productRef = database.ref('products/' + key);
            productRef.transaction((currentProduct) => {
                if (currentProduct) {
                    const newQuantity = currentProduct.productQuantity + quantityToAdd;
                    const newTotalCost = newQuantity * currentProduct.productPrice;
                    const newDue = newTotalCost - currentProduct.payment;

                    currentProduct.productQuantity = newQuantity;
                    currentProduct.totalCost = parseFloat(newTotalCost.toFixed(2));
                    currentProduct.due = parseFloat(newDue.toFixed(2));
                    currentProduct.purchaseDate = new Date().toLocaleString('bn-BD'); // рж╢рзЗрж╖ ржХрзНрж░ржпрж╝ рж╕ржоржпрж╝ ржЖржкржбрзЗржЯ
                }
                return currentProduct;
            })
            .then(() => {
                alert(`рж╕рзНржЯржХ рж╕ржлрж▓ржнрж╛ржмрзЗ ${quantityToAdd} ржкрж░рж┐ржорж╛ржг ржмрж╛ржбрж╝рж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗред`);
                quantityInput.value = ''; // ржЗржиржкрзБржЯ ржлрж┐рж▓рзНржб ржЦрж╛рж▓рж┐ ржХрж░рж╛
            })
            .catch((error) => {
                console.error("рж╕рзНржЯржХ ржЖржкржбрзЗржЯрзЗ рждрзНрж░рзБржЯрж┐:", error);
                alert("рж╕рзНржЯржХ ржЖржкржбрзЗржЯ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред");
            });
        }

        // рзм. ржкржгрзНржп ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
        window.deleteProduct = function(key) {
            if (confirm("ржЖржкржирж┐ ржХрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржПржЗ ржкржгрзНржпржЯрж┐ ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ ржЪрж╛ржи?")) {
                database.ref('products/' + key).remove()
                    .then(() => {
                        alert("ржкржгрзНржп рж╕ржлрж▓ржнрж╛ржмрзЗ ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ!");
                    })
                    .catch((error) => {
                        console.error("ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛рж░ рж╕ржоржпрж╝ рждрзНрж░рзБржЯрж┐:", error);
                        alert("ржкржгрзНржп ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред");
                    });
            }
        }
    </script>
</body>
</html>
