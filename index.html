<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APK BY CEO APON</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f0f0f0;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
    <h1>APK BY CEO APON</h1>
    <form id="product-form">
        <label for="product-name">পণ্যের নাম:</label>
        <input type="text" id="product-name" name="product-name"><br><br>
        <label for="supplier-name">সাপ্লাইয়ার নাম:</label>
        <input type="text" id="supplier-name" name="supplier-name"><br><br>
        <label for="product-quantity">পরিমাণ:</label>
        <input type="number" id="product-quantity" name="product-quantity"><br><br>
        <label for="product-price">মূল্য:</label>
        <input type="number" id="product-price" name="product-price"><br><br>
        <label for="payment">পেমেন্ট:</label>
        <input type="number" id="payment" name="payment"><br><br>
        <button id="add-product-btn">পণ্য যোগ করুন</button>
    </form>
    <table id="product-table">
        <thead>
            <tr>
                <th>পণ্যের নাম</th>
                <th>সাপ্লাইয়ার নাম</th>
                <th>পরিমাণ</th>
                <th>মূল্য</th>
                <th>মোট খরচ</th>
                <th>পেমেন্ট</th>
                <th>বাকি</th>
                <th>ক্রয় তারিখ ও সময়</th>
                <th>পেমেন্ট করুন</th>
                <th>ক্রয় করুন</th>
                <th>ডিলিট</th>
            </tr>
        </thead>
        <tbody id="product-table-body">
        </tbody>
    </table>

    <script>
        // আপনার Firebase কনফিগারেশন
        const firebaseConfig = {
            apiKey: "AIzaSyAWq4Lkt0GCtjcZGvZijI2OO7-6Hu5molM",
            authDomain: "note-by-ceo-5b42a.firebaseapp.com",
            databaseURL: "https://note-by-ceo-5b42a-default-rtdb.firebaseio.com",
            projectId: "note-by-ceo-5b42a",
            storageBucket: "note-by-ceo-5b42a.firebasestorage.app",
            messagingSenderId: "442049744344",
            appId: "1:442049744344:web:8be3da17ede606bb6df6ad",
            measurementId: "G-2V9Y6CEYZE"
        };

        // Firebase ইনিশিয়ালাইজ করা
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const productsRef = database.ref('products');

        let products = []; // লোকাল ভেরিয়েবল হিসেবে রাখা হলো ডিসপ্লের সুবিধার জন্য

        // পণ্য যোগ করা (Firebase-এ)
        document.getElementById('add-product-btn').addEventListener('click', (e) => {
            e.preventDefault();
            let productName = document.getElementById('product-name').value;
            let supplierName = document.getElementById('supplier-name').value;
            let productQuantity = parseInt(document.getElementById('product-quantity').value);
            let productPrice = parseFloat(document.getElementById('product-price').value);
            let payment = parseFloat(document.getElementById('payment').value);

            // ভ্যালিডেশন চেক (খালি থাকলে এরর এড়াতে)
            if(!productName || !supplierName || isNaN(productQuantity) || isNaN(productPrice) || isNaN(payment)) {
                alert("দয়া করে সব তথ্য সঠিক ভাবে পূরণ করুন");
                return;
            }

            let totalCost = productQuantity * productPrice;
            let due = totalCost - payment;

            let product = {
                productName,
                supplierName,
                productQuantity,
                productPrice,
                totalCost,
                payment,
                due,
                purchaseDate: new Date().toLocaleString()
            };

            // Firebase এ পাঠানো
            productsRef.push(product);
            document.getElementById('product-form').reset();
        });

        // Firebase থেকে ডাটা লোড করা এবং টেবিলে দেখানো
        productsRef.on('value', (snapshot) => {
            let tableBody = document.getElementById('product-table-body');
            tableBody.innerHTML = '';
            products = []; // লিস্ট ক্লিয়ার করা

            snapshot.forEach((childSnapshot) => {
                let product = childSnapshot.val();
                product.key = childSnapshot.key; // Firebase এর key সেভ রাখা ডিলিট/আপডেটের জন্য
                products.push(product);
            });

            // আপনার অরিজিনাল স্টাইলে ডিসপ্লে করা
            products.forEach((product, index) => {
                // পেমেন্ট ডেট চেক
                let paymentDateDisplay = product.paymentDate ? product.paymentDate : '';

                let row = `<tr>
                    <td>${product.productName}</td>
                    <td>${product.supplierName}</td>
                    <td>${product.productQuantity}</td>
                    <td>${product.productPrice}</td>
                    <td>${product.totalCost}</td>
                    <td>${product.payment}</td>
                    <td>${product.due}</td>
                    <td>${product.purchaseDate}</td>
                    <td><input type="number" id="payment-${index}" placeholder="পেমেন্ট করুন">
                    <button onclick="makePayment('${product.key}', ${index})">পেমেন্ট</button><br>
                    <small>পেমেন্ট সময়: ${paymentDateDisplay}</small></td>
                    <td><input type="number" id="quantity-${index}" placeholder="পরিমাণ">
                    <button onclick="buyProduct('${product.key}', ${index})">ক্রয় করুন</button><br>
                    <small>ক্রয় সময়: ${product.purchaseDate}</small></td>
                    <td><button onclick="deleteProduct('${product.key}')">ডিলিট</button></td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        });

        // পেমেন্ট করা
        function makePayment(key, index) {
            let paymentInput = document.getElementById(`payment-${index}`).value;
            let paymentAmount = parseFloat(paymentInput);
            
            if (paymentAmount > 0) {
                // বর্তমান ডাটা খুঁজে বের করা
                let product = products.find(p => p.key === key);
                
                let newPayment = product.payment + paymentAmount;
                let newDue = product.due - paymentAmount;
                let newPaymentDate = new Date().toLocaleString();

                // Firebase আপডেট
                productsRef.child(key).update({
                    payment: newPayment,
                    due: newDue,
                    paymentDate: newPaymentDate
                });
            }
        }

        // পণ্য পুনরায় ক্রয় (স্টক আপডেট)
        function buyProduct(key, index) {
            let quantityInput = document.getElementById(`quantity-${index}`).value;
            let quantity = parseInt(quantityInput);

            if (quantity > 0) {
                let product = products.find(p => p.key === key);

                let newQuantity = product.productQuantity + quantity;
                let newTotalCost = newQuantity * product.productPrice; // নতুন লজিক অনুযায়ী টোটাল আপডেট হবে
                // অথবা আপনার আগের লজিক যদি রাখতে চান: let newTotalCost = newQuantity + product.productPrice (এটা ভুল মনে হচ্ছে, গুণ হবে, কিন্তু আপনার আগের কোডে যোগ ছিল। আমি গুণ করে দিয়েছি সঠিক হিসাবের জন্য। আপনি চাইলে আগের মতো রাখতে পারেন।)
                
                // সঠিক হিসাব:
                newTotalCost = product.productPrice * newQuantity; 
                let newDue = newTotalCost - product.payment;
                let newPurchaseDate = new Date().toLocaleString();

                productsRef.child(key).update({
                    productQuantity: newQuantity,
                    totalCost: newTotalCost,
                    due: newDue,
                    purchaseDate: newPurchaseDate
                });
            }
        }

        // ডিলিট করা
        function deleteProduct(key) {
            productsRef.child(key).remove();
        }

    </script>
</body>
</html>
