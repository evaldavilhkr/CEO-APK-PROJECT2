<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>APK BY CEO APON - পূর্ণাঙ্গ ইনভেন্টরি</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        th { background-color: #10b981 !important; color: white !important; }
        .container-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body class="p-4 sm:p-8">
    <div id="app-container" class="max-w-6xl mx-auto bg-white p-4 sm:p-6 rounded-xl container-shadow">
        <header class="text-center pb-4 border-b border-gray-200 mb-6">
            <h1 class="text-3xl font-extrabold text-emerald-600">APK BY CEO APON</h1>
            <p class="text-sm text-gray-500">ইনভেন্টরি, ডিলিট এবং পার্মানেন্ট পেমেন্ট হিস্ট্রি</p>
        </header>

        <div id="message-box" class="hidden p-3 mb-4 rounded-lg font-semibold transition-all duration-300"></div>

        <div id="login-form" class="max-w-sm mx-auto p-6 bg-gray-50 rounded-lg shadow-inner">
            <label class="block text-sm font-medium text-gray-700 mb-2">পাসওয়ার্ড:</label>
            <input type="password" id="password" placeholder="পাসওয়ার্ড লিখুন" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 outline-none mb-4">
            <button id="login-btn" class="w-full p-3 bg-emerald-500 text-white font-bold rounded-lg hover:bg-emerald-600 transition">লগইন</button>
        </div>

        <div id="app-content" class="hidden">
            <section class="mb-4">
                <input type="text" id="search-input" placeholder="পণ্যের নাম বা সাপ্লাইয়ার দিয়ে সার্চ করুন..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-emerald-500 outline-none">
            </section>

            <section class="mb-8 p-4 border border-emerald-500 rounded-xl bg-green-50/50">
                <h2 class="text-xl font-semibold text-emerald-600 mb-4 border-b pb-2">নতুন পণ্য যোগ করুন</h2>
                <form id="product-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="product-name" placeholder="পণ্যের নাম" required class="w-full p-2 border rounded-lg outline-none">
                        <input type="text" id="supplier-name" placeholder="সাপ্লাইয়ার নাম" class="w-full p-2 border rounded-lg outline-none">
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <input type="number" id="product-quantity" placeholder="পরিমাণ" required min="1" class="p-2 border rounded-lg outline-none">
                        <input type="number" id="product-price" placeholder="ইউনিট মূল্য" required class="p-2 border rounded-lg outline-none">
                        <input type="number" id="payment-input" placeholder="পেমেন্ট" required class="p-2 border rounded-lg outline-none">
                    </div>
                    <button type="submit" class="w-full p-3 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700 transition">পণ্য যোগ করুন</button>
                </form>
            </section>

            <section class="mb-8">
                <h2 class="text-xl font-semibold text-emerald-600 mb-4">পণ্যের তালিকা</h2>
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-semibold uppercase">পণ্য / সাপ্লাইয়ার</th>
                                <th class="px-4 py-2 text-center text-xs font-semibold uppercase">পরিমাণ</th>
                                <th class="px-4 py-2 text-center text-xs font-semibold uppercase">মূল্য</th>
                                <th class="px-4 py-2 text-center text-xs font-semibold uppercase">মোট খরচ</th>
                                <th class="px-4 py-2 text-center text-xs font-semibold uppercase">পেমেন্ট</th>
                                <th class="px-4 py-2 text-center text-xs font-semibold uppercase">বাকি</th>
                                <th class="px-4 py-2 text-center text-xs font-semibold uppercase">অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="product-table-body" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </section>

            <section class="mb-8">
                <h2 class="text-xl font-semibold text-emerald-600 mb-4">পেমেন্ট হিস্ট্রি (ডাটাবেস রেকর্ড)</h2>
                <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-emerald-600 text-white">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-semibold uppercase">পণ্যের নাম</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold uppercase">পেমেন্টের পরিমাণ</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold uppercase">তারিখ ও সময়</th>
                            </tr>
                        </thead>
                        <tbody id="payment-history-body" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <div id="payment-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-xl w-full max-w-sm">
            <h3 id="modal-title" class="font-bold text-lg mb-4">পেমেন্ট করুন</h3>
            <p id="modal-due" class="text-sm text-red-500 mb-4"></p>
            <input type="number" id="m-pay-amount" class="w-full p-2 border rounded mb-4 outline-none" placeholder="পরিমাণ লিখুন">
            <div class="flex justify-end gap-2">
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 rounded">বাতিল</button>
                <button id="confirm-pay-btn" class="px-4 py-2 bg-indigo-500 text-white rounded">নিশ্চিত</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase কনফিগারেশন
        const firebaseConfig = {
            apiKey: "AIzaSyAWq4Lkt0GCtjcZGvZijI2OO7-6Hu5molM",
            authDomain: "note-by-ceo-5b42a.firebaseapp.com",
            databaseURL: "https://note-by-ceo-5b42a-default-rtdb.firebaseio.com",
            projectId: "note-by-ceo-5b42a",
            storageBucket: "note-by-ceo-5b42a.firebasestorage.app",
            messagingSenderId: "442049744344",
            appId: "1:442049744344:web:8be3da17ede606bb6df6ad",
            measurementId: "G-2V9Y6CEYZE"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const productsRef = database.ref('products');
        const paymentHistoryRef = database.ref('paymentHistory');

        const SECRET_PASSWORD = "CEO1212";
        let products = [];
        let activeProductKey = null;

        // লগইন ফাংশন
        document.getElementById('login-btn').onclick = () => {
            if (document.getElementById('password').value === SECRET_PASSWORD) {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
            } else { alert("ভুল পাসওয়ার্ড!"); }
        };

        function showMessage(text, type) {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = text;
            msgBox.className = `p-3 mb-4 rounded-lg font-semibold ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
            msgBox.classList.remove('hidden');
            setTimeout(() => msgBox.classList.add('hidden'), 3000);
        }

        // সার্চ বক্স লজিক
        document.getElementById('search-input').addEventListener('input', (e) => {
            const searchText = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#product-table-body tr');
            rows.forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(searchText) ? '' : 'none';
            });
        });

        // নতুন পণ্য যোগ করা
        document.getElementById('product-form').onsubmit = (e) => {
            e.preventDefault();
            const pName = document.getElementById('product-name').value;
            const sName = document.getElementById('supplier-name').value || 'N/A';
            const qty = parseInt(document.getElementById('product-quantity').value);
            const price = parseFloat(document.getElementById('product-price').value);
            const pay = parseFloat(document.getElementById('payment-input').value);
            const total = qty * price;

            productsRef.push({
                productName: pName,
                supplierName: sName,
                productQuantity: qty,
                productPrice: price,
                totalCost: total,
                payment: pay,
                due: total - pay,
                date: new Date().toLocaleString('bn-BD')
            }).then(() => {
                showMessage(`"${pName}" যোগ করা হয়েছে।`, 'success');
                e.target.reset();
            });
        };

        // পেমেন্ট মডাল খোলা
        window.openPaymentModal = (key) => {
            activeProductKey = key;
            const product = products.find(p => p.key === key);
            document.getElementById('modal-title').innerText = `পেমেন্ট: ${product.productName}`;
            document.getElementById('modal-due').innerText = `মোট বাকি: ৳${product.due.toFixed(2)}`;
            document.getElementById('payment-modal').classList.remove('hidden');
        };

        window.closeModal = () => {
            document.getElementById('payment-modal').classList.add('hidden');
            document.getElementById('m-pay-amount').value = '';
        };

        // পেমেন্ট নিশ্চিত করা (আপনার দেওয়া লজিক)
        document.getElementById('confirm-pay-btn').onclick = () => {
            const amount = parseFloat(document.getElementById('m-pay-amount').value);
            const product = products.find(p => p.key === activeProductKey);

            if (!isNaN(amount) && amount > 0 && amount <= product.due) {
                const newPayment = product.payment + amount;
                const newDue = product.due - amount;

                productsRef.child(activeProductKey).update({
                    payment: newPayment,
                    due: newDue,
                    lastPaymentDate: new Date().toLocaleString('bn-BD')
                })
                .then(() => {
                    closeModal();
                    showMessage(`৳ ${amount} পেমেন্ট সফল।`, 'success');
                    // পেমেন্ট হিস্ট্রি আপডেট
                    paymentHistoryRef.push({
                        productName: product.productName,
                        paymentAmount: amount,
                        paymentDate: new Date().toLocaleString('bn-BD')
                    });
                });
            } else { alert("সঠিক পরিমাণ দিন!"); }
        };

        // ডিলিট ফাংশন
        window.deleteProduct = (key, name) => {
            if (confirm(`আপনি কি নিশ্চিত যে "${name}" ডিলিট করবেন?`)) {
                productsRef.child(key).remove().then(() => showMessage("ডিলিট সফল হয়েছে।", "error"));
            }
        };

        // ডেটা লোড করা
        productsRef.on('value', (snapshot) => {
            const body = document.getElementById('product-table-body');
            body.innerHTML = '';
            products = [];
            snapshot.forEach((child) => {
                const p = child.val();
                p.key = child.key;
                products.push(p);
                body.insertAdjacentHTML('afterbegin', `
                    <tr class="text-sm border-b">
                        <td class="px-4 py-3"><b>${p.productName}</b><br><span class="text-xs text-gray-400">${p.supplierName}</span></td>
                        <td class="px-4 py-3 text-center">${p.productQuantity}</td>
                        <td class="px-4 py-3 text-center">৳${p.productPrice}</td>
                        <td class="px-4 py-3 text-center font-bold text-emerald-600">৳${p.totalCost.toFixed(2)}</td>
                        <td class="px-4 py-3 text-center text-blue-600 font-bold">৳${p.payment.toFixed(2)}</td>
                        <td class="px-4 py-3 text-center text-red-500 font-bold">৳${p.due.toFixed(2)}</td>
                        <td class="px-4 py-3 text-center flex flex-col gap-1">
                            <button onclick="openPaymentModal('${p.key}')" class="bg-indigo-500 text-white px-2 py-1 rounded text-xs">পেমেন্ট</button>
                            <button onclick="deleteProduct('${p.key}', '${p.productName}')" class="bg-red-500 text-white px-2 py-1 rounded text-xs">ডিলিট</button>
                        </td>
                    </tr>
                `);
            });
        });

        // পেমেন্ট হিস্ট্রি লোড (আপনার লজিক)
        paymentHistoryRef.on('value', (snapshot) => {
            const hBody = document.getElementById('payment-history-body');
            hBody.innerHTML = '';
            snapshot.forEach((child) => {
                const data = child.val();
                hBody.insertAdjacentHTML('afterbegin', `
                    <tr class="border-b text-sm">
                        <td class="px-4 py-2">${data.productName}</td>
                        <td class="px-4 py-2 text-emerald-600 font-bold">৳ ${data.paymentAmount.toFixed(2)}</td>
                        <td class="px-4 py-2 text-gray-500">${data.paymentDate}</td>
                    </tr>
                `);
            });
        });
    </script>
</body>
</html>
